{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">掼蛋比赛计分板</h1>
<a href="{{ url_for('create_match') }}" class="btn btn-primary mb-3">创建新比赛</a>
<h2 class="mt-4">比赛列表</h2>
<ul class="list-group mb-4">
    {% for match in matches %}
        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
            <div class="col-12 col-md-8 mb-2 mb-md-0">
                <a href="{{ url_for('match_detail', match_id=match.id) }}" class="text-decoration-none">
                    [{{ loop.index }}] {{ match.time.strftime('%Y-%m-%d %H:%M') }} - {{ match.location }}
                </a>
                {% if match.status == 'ongoing' %}
                    <span class="badge bg-primary ms-2">进行中</span>
                {% else %}
                    <span class="badge bg-success ms-2">已结束</span>
                {% endif %}
            </div>
            {% if match.status == 'ongoing' %}
            <form action="{{ url_for('delete_match', match_id=match.id) }}" method="POST" class="d-inline col-12 col-md-4 text-md-end">
                <button type="submit" class="btn btn-danger btn-sm" 
                        onclick="return confirm('确定要删除这场比赛吗？');">删除</button>
            </form>
            {% endif %}
        </li>
    {% endfor %}
</ul>

<h2 class="mt-4">选手总分排行榜</h2>
{% if score_rankings %}
<table class="table table-striped table-responsive">
    <thead>
        <tr>
            <th>排名</th>
            <th>选手姓名</th>
            <th>总积分</th>
        </tr>
    </thead>
    <tbody>
        {% for rank, name, score in score_rankings %}
        <tr>
            <td>{{ rank }}</td>
            <td>{{ name }}</td>
            <td>{{ score }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-muted">暂无选手数据，请先创建比赛并录入成绩。</p>
{% endif %}

<h2 class="mt-4">选手胜率排行榜</h2>
{% if win_rate_rankings %}
<table class="table table-striped table-responsive">
    <thead>
        <tr>
            <th>排名</th>
            <th>选手姓名</th>
            <th>参赛场次</th>
            <th>胜利场次</th>
            <th>胜率</th>
        </tr>
    </thead>
    <tbody>
        {% for rank, name, matches, wins, win_rate in win_rate_rankings %}
        <tr>
            <td>{{ rank }}</td>
            <td>{{ name }}</td>
            <td>{{ matches }}</td>
            <td>{{ wins }}</td>
            <td>{{ win_rate }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-muted">暂无胜率数据，请先结束一些比赛。</p>
{% endif %}
{% endblock %}